p8105_hw6_hmz2105
================
Haley Zylberberg

``` r
library (tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.3     ✔ readr     2.1.4
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.0
    ## ✔ ggplot2   3.4.3     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.2     ✔ tidyr     1.3.0
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
set.seed(123)
```

## Problem 2

In this problem, I will use Central Park weather data to create a simple
linear regression with tmax as the response and tmin and prcp as the
predictors. I use 5000 bootstrap samples to calculate r squared and log
(B1\*B2), and then plot the distribution of these estimates.

First pull in weather data.

``` r
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2022-01-01",
    date_max = "2022-12-31") |>
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY"),
    tmin = tmin / 10,
    tmax = tmax / 10) |>
  select(name, id, everything())
```

    ## using cached file: /Users/Haley/Library/Caches/org.R-project.R/R/rnoaa/noaa_ghcnd/USW00094728.dly

    ## date created (size, mb): 2023-10-04 17:08:38.483749 (8.527)

    ## file min/max dates: 1869-01-01 / 2023-10-31

Next create a bootstrap with 5000 samples. Will create a dataframe that
retains the r squared and the log(B1\*B2) only.

``` r
boot_sample = function(df) {
  sample_frac(df, replace = TRUE)
}

boot_straps = 
  tibble(strap_number = 1:5000) |> 
  mutate(
    strap_sample = map(strap_number, \(i) boot_sample(df = weather_df))
  )

bootstrap_results =
  boot_straps |> 
  mutate(
    models = map(strap_sample, \(df) lm(tmax ~ tmin + prcp, data = df)),
    results = map(models, broom::glance),
    results2 = map(models, broom::tidy)
  ) |> 
  select(-strap_sample, -models) |> 
  unnest(results, results2) 
```

    ## Warning: `unnest()` has a new interface. See `?unnest` for details.
    ## ℹ Try `df %>% unnest(c(results, results2))`, with `mutate()` if needed.

``` r
plot = bootstrap_results |> 
  janitor::clean_names()|>
  filter(term != "(Intercept)")|>
  group_by(strap_number, r_squared) |> 
summarize(log_product = log(prod(abs(estimate))))
```

    ## `summarise()` has grouped output by 'strap_number'. You can override using the
    ## `.groups` argument.

Next will plot the distribution of r squared.

``` r
plot|>
ggplot(aes(x = r_squared)) +
    geom_density() +
  labs(title = "Distribution of R-squared",
       x = "R-squared",
       y = "Frequency") +
  theme_minimal()
```

![](p8105_hw6_hmz2105_files/figure-gfm/plot%20r%20squared-1.png)<!-- -->

- The density plot of r squared values shows the distribution of the
  goodness of fit for the linear regression models. R squared measures
  the proportion of the variability in tmax that is explained by the
  predictors tmin and prcp. In this plot, the distribution is skewed to
  the left but overall appears mostly normal. As the values are
  relatively close to 1, the model has a high goodness of fit.

Next will plot the distribution of log(B1\*B2).

``` r
plot|>
ggplot(aes(x = log_product)) +
  geom_density() +
  labs(title = "Distribution of log(B1 * B2)",
       x = "log(B1 * B2)",
       y = "Frequency") +
  theme_minimal()
```

![](p8105_hw6_hmz2105_files/figure-gfm/plot%20log-1.png)<!-- -->

- This density plot provides insights into the joint effect of the
  predictor variables (tmin and prcp) on tmax. This distribution is very
  skewed to the left. It appears that there is a joint effect between
  tmin and prcp.

Next will make a table showing the 95% confidence levels for r squared
and log (B1\*B2).

``` r
confidence_intervals <- data.frame(
  variable = c("r_squared", "log_product"),
  lower_CI = c(quantile(pull(plot, r_squared), 0.025), quantile(pull(plot, log_product), 0.025)),
  upper_CI = c(quantile(pull(plot, r_squared), 0.975), quantile(pull(plot, log_product), 0.975))
)

confidence_intervals|> 
  knitr::kable()
```

| variable    |   lower_CI |   upper_CI |
|:------------|-----------:|-----------:|
| r_squared   |  0.8882079 |  0.9402552 |
| log_product | -8.6969696 | -4.6011529 |

## Problem 3

In this problem I will create a linear regression model looking at
predictors of a child’s birth weight using a dataset 4,342 children
related variables.

First, I will import and clean the dataset, taking into acount recoding
variables and creating factors.

``` r
birthweight_df = 
  read_csv("data/birthweight.csv") |>
    janitor::clean_names() |>
  mutate(
 babysex = case_match(
    babysex, 2~ 'female', 1 ~ 'male'),
 frace = case_match(
    frace, 9~'Unknown', 8~'Other', 4~ 'Puerto Rican', 3~ 'Asian', 2~ 'Black', 1 ~ 'White'),
  malform = case_match(
   malform, 0~ 'absent', 1 ~ 'present'),
 mrace = case_match(
    mrace, 8~'Other', 4~ 'Puerto Rican', 3~ 'Asian', 2~ 'Black', 1 ~ 'White'),
 frace = forcats::fct_relevel(frace, c("White", "Black", "Asian", "Puerto Rican", "Other")),
  mrace = forcats::fct_relevel(mrace, c("White", "Black", "Asian", "Puerto Rican"))
  )
```

    ## Rows: 4342 Columns: 20
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (20): babysex, bhead, blength, bwt, delwt, fincome, frace, gaweeks, malf...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

The birthweight data has 4342 observations and 20 variables named
babysex, bhead, blength, bwt, delwt, fincome, frace, gaweeks, malform,
menarche, mheight, momage, mrace, parity, pnumlbw, pnumsga, ppbmi, ppwt,
smoken, wtgain.

Next, will create a linear regression model of birthweight. Will use the
variables sex of baby (babysex), length of baby (blength), gestational
age of baby (gaweeks), average cigarettes mother smoked (smoken), and
mother’s weight gain during pregnancy (wtgain).

``` r
fit = lm(bwt ~ babysex + blength + gaweeks + smoken + wtgain, data = birthweight_df)

fit |> 
 broom::tidy()
```

    ## # A tibble: 6 × 5
    ##   term        estimate std.error statistic  p.value
    ##   <chr>          <dbl>     <dbl>     <dbl>    <dbl>
    ## 1 (Intercept) -4214.      97.6      -43.2  0       
    ## 2 babysexmale    18.7     10.1        1.86 6.30e- 2
    ## 3 blength       125.       2.01      62.0  0       
    ## 4 gaweeks        26.3      1.71      15.4  6.86e-52
    ## 5 smoken         -2.85     0.678     -4.20 2.74e- 5
    ## 6 wtgain          4.55     0.467      9.74 3.40e-22
